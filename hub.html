<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Forge Collaboration Hub | FrontlineOps V6.3.1</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --bg-primary: #0a0e17;
            --bg-secondary: #151923;
            --bg-tertiary: #1e2433;
            --border: #2a3447;
            --text-primary: #e8eaed;
            --text-secondary: #9aa0b0;
            --accent-green: #4caf50;
            --accent-blue: #2196f3;
            --accent-orange: #ff9800;
            --accent-red: #f44336;
            --accent-yellow: #ffc107;
            --accent-pink: #e91e63;
            --accent-purple: #9c27b0;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
        }
        
        .container {
            display: grid;
            grid-template-columns: 280px 1fr;
            grid-template-rows: 60px 1fr;
            height: 100vh;
        }
        
        /* Header */
        header {
            grid-column: 1 / -1;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
            padding: 0 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .logo-section {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .menu-toggle {
            display: none;
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 24px;
            cursor: pointer;
            padding: 8px;
            line-height: 1;
        }
        
        .logo { font-size: 20px; font-weight: 700; }
        
        .version-badge {
            background: var(--accent-blue);
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--accent-green);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        /* Sidebar */
        aside {
            background: var(--bg-secondary);
            border-right: 1px solid var(--border);
            padding: 16px 0;
            overflow-y: auto;
            transition: transform 0.3s ease;
        }
        
        /* Desktop: sidebar always visible */
        aside.collapsed {
            transform: none;
        }
        
        .nav-section {
            margin-bottom: 24px;
        }
        
        .nav-section-title {
            padding: 8px 24px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            color: var(--text-secondary);
            letter-spacing: 0.5px;
        }
        
        .nav-btn {
            width: 100%;
            background: none;
            border: none;
            color: var(--text-primary);
            padding: 12px 24px;
            text-align: left;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: all 0.2s;
            position: relative;
        }
        
        .nav-btn:hover {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .nav-btn.active {
            background: rgba(33, 150, 243, 0.1);
            color: var(--accent-blue);
        }
        
        .nav-btn.active::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 3px;
            background: var(--accent-blue);
        }
        
        .icon {
            font-size: 18px;
            width: 18px;
            text-align: center;
        }
        
        .badge {
            margin-left: auto;
            background: var(--accent-red);
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: 600;
        }
        
        /* Main Content */
        main {
            overflow-y: auto;
            padding: 32px;
        }
        
        .view {
            display: none;
        }
        
        .view.active {
            display: block;
        }
        
        /* Status Cards */
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }
        
        .status-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.2s;
        }
        
        .status-card:hover {
            border-color: var(--accent-blue);
            transform: translateY(-2px);
        }
        
        .status-card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }
        
        .status-card-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            position: relative;
        }
        
        .status-indicator.active {
            background: var(--accent-green);
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.2);
        }
        
        .status-indicator.idle {
            background: var(--text-secondary);
        }
        
        .status-indicator.testing {
            background: var(--accent-blue);
            animation: pulse 2s infinite;
        }
        
        .status-indicator.error {
            background: var(--accent-red);
        }
        
        .status-indicator {
            font-size: 14px;
            margin-left: 8px;
        }
        
        .status-card-value {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 8px;
        }
        
        .status-card-label {
            font-size: 14px;
            color: var(--text-secondary);
        }
        
        /* System Status */
        .system-status {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 32px;
        }
        
        .system-status-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 24px;
        }
        
        .system-status-title {
            font-size: 18px;
            font-weight: 700;
        }
        
        .coordination-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }
        
        .process-card {
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 20px;
        }
        
        .process-card.active {
            border-color: var(--accent-green);
            background: rgba(76, 175, 80, 0.05);
        }
        
        .process-card.locked {
            border-color: var(--accent-yellow);
            background: rgba(255, 193, 7, 0.05);
        }
        
        .process-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }
        
        .process-icon {
            font-size: 24px;
        }
        
        .process-name {
            font-weight: 600;
            flex: 1;
        }
        
        .process-status {
            font-size: 12px;
            padding: 4px 10px;
            border-radius: 12px;
            font-weight: 600;
        }
        
        .process-status.running {
            background: var(--accent-green);
            color: white;
        }
        
        .process-status.waiting {
            background: var(--accent-yellow);
            color: #000;
        }
        
        .process-status.idle {
            background: var(--bg-secondary);
            color: var(--text-secondary);
        }
        
        .process-meta {
            font-size: 13px;
            color: var(--text-secondary);
            margin-top: 8px;
        }
        
        /* Settings Panel */
        .settings-section {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 20px;
        }
        
        .settings-header {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .setting-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 0;
            border-bottom: 1px solid var(--border);
        }
        
        .setting-row:last-child {
            border-bottom: none;
        }
        
        .setting-label {
            flex: 1;
        }
        
        .setting-title {
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        .setting-description {
            font-size: 13px;
            color: var(--text-secondary);
        }
        
        .toggle-switch {
            position: relative;
            width: 48px;
            height: 26px;
            background: var(--bg-tertiary);
            border-radius: 13px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .toggle-switch.active {
            background: var(--accent-green);
        }
        
        .toggle-slider {
            position: absolute;
            top: 3px;
            left: 3px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s;
        }
        
        .toggle-switch.active .toggle-slider {
            transform: translateX(22px);
        }
        
        .input-field {
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            color: var(--text-primary);
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 14px;
            width: 100px;
        }
        
        .input-field:focus {
            outline: none;
            border-color: var(--accent-blue);
            box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.1);
        }
        
        .input-field::placeholder {
            color: var(--text-secondary);
            opacity: 0.5;
        }
        
        /* Activity Log */
        .activity-log {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 24px;
        }
        
        .log-entry {
            padding: 12px 0;
            border-bottom: 1px solid var(--border);
            display: flex;
            gap: 16px;
        }
        
        .log-entry:last-child {
            border-bottom: none;
        }
        
        .log-time {
            font-size: 12px;
            color: var(--text-secondary);
            min-width: 80px;
        }
        
        .log-message {
            flex: 1;
        }
        
        .log-type {
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
        }
        
        .log-type.info {
            background: rgba(33, 150, 243, 0.2);
            color: var(--accent-blue);
        }
        
        .log-type.success {
            background: rgba(76, 175, 80, 0.2);
            color: var(--accent-green);
        }
        
        .log-type.warning {
            background: rgba(255, 152, 0, 0.2);
            color: var(--accent-orange);
        }
        
        .log-type.error {
            background: rgba(244, 67, 54, 0.2);
            color: var(--accent-red);
        }
        
        /* Preview iframe */
        .preview-container {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            overflow: hidden;
            height: calc(100vh - 200px);
        }
        
        .preview-header {
            padding: 16px 24px;
            background: var(--bg-tertiary);
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .preview-iframe {
            width: 100%;
            height: calc(100% - 60px);
            border: none;
        }
        
        .btn {
            background: var(--accent-blue);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }
        
        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(33, 150, 243, 0.3);
        }
        
        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }
        
        /* Mobile Responsive */
        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
            }
            
            .menu-toggle {
                display: block;
            }
            
            aside {
                position: fixed;
                left: 0;
                top: 60px;
                bottom: 0;
                width: 280px;
                z-index: 1000;
                box-shadow: 2px 0 12px rgba(0, 0, 0, 0.5);
            }
            
            /* On mobile: collapsed means hidden */
            aside.collapsed {
                transform: translateX(-100%);
            }
            
            main {
                padding: 16px;
            }
            
            .status-grid {
                grid-template-columns: 1fr;
            }
            
            .coordination-grid {
                grid-template-columns: 1fr;
            }
            
            .preview-container {
                height: calc(100vh - 300px);
            }
            
            .logo {
                font-size: 16px;
            }
            
            .version-badge {
                font-size: 10px;
                padding: 3px 8px;
            }
        }
        
        /* Overlay for mobile menu */
        .overlay {
            display: none;
            position: fixed;
            top: 60px;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
        }
        
        .overlay.active {
            display: block;
    </style>
</head>
<body>
    <div class="container">
        <header>
            <button class="menu-toggle" id="menuToggle" aria-label="Toggle menu">
                ‚ò∞
            </button>
            <div class="logo-section">
                <div class="logo">‚ö° Forge Hub</div>
                <div class="version-badge" id="versionBadge" title="Click to see last update">
                    V6.3.1
                </div>
                <div class="status-dot"></div>
            </div>
        </header>
        <div class="overlay" id="overlay"></div>
        
        <aside id="sidebar">
            <nav>
                <div class="nav-section">
                    <div class="nav-section-title">Monitoring</div>
                    <button class="nav-btn active" data-view="dashboard">
                        <span class="icon">üìä</span>
                        Dashboard
                    </button>
                    <button class="nav-btn" data-view="coordination">
                        <span class="icon">üîÑ</span>
                        System Status
                    </button>
                    <button class="nav-btn" data-view="testing">
                        <span class="icon">üß™</span>
                        Testing
                        <span class="badge" id="test-badge" style="display:none;">0</span>
                    </button>
                </div>
                
                <div class="nav-section">
                    <div class="nav-section-title">Configuration</div>
                    <button class="nav-btn" data-view="settings">
                        <span class="icon">‚öôÔ∏è</span>
                        Settings
                    </button>
                </div>
                
                <div class="nav-section">
                    <div class="nav-section-title">Activity</div>
                    <button class="nav-btn" data-view="activity">
                        <span class="icon">üìù</span>
                        Activity Log
                    </button>
                    <button class="nav-btn" data-view="preview">
                        <span class="icon">üëÅÔ∏è</span>
                        Live Preview
                    </button>
                </div>
            </nav>
        </aside>
        
        <main>
            <!-- Dashboard View -->
            <div id="dashboard" class="view active">
                <h1 style="margin-bottom: 32px;">Dashboard</h1>
                
                <div class="status-grid">
                    <div class="status-card">
                        <div class="status-card-header">
                            <div class="status-card-title">Current Iteration</div>
                            <div class="status-indicator active"></div>
                        </div>
                        <div class="status-card-value" id="current-iteration">8</div>
                        <div class="status-card-label">of 20 total</div>
                    </div>
                    
                    <div class="status-card">
                        <div class="status-card-header">
                            <div class="status-card-title">Tests Passed</div>
                            <div class="status-indicator idle"></div>
                        </div>
                        <div class="status-card-value" id="tests-passed">0</div>
                        <div class="status-card-label">Phase A: 0/50</div>
                    </div>
                    
                    <div class="status-card">
                        <div class="status-card-header">
                            <div class="status-card-title">Version</div>
                            <div class="status-indicator active"></div>
                        </div>
                        <div class="status-card-value" id="code-version">V6.2.8</div>
                        <div class="status-card-label" id="phase-status">INIT Phase</div>
                    </div>
                    
                    <div class="status-card">
                        <div class="status-card-header">
                            <div class="status-card-title">Auto-Deploy</div>
                            <div class="status-indicator active"></div>
                        </div>
                        <div class="status-card-value">‚úÖ</div>
                        <div class="status-card-label">GitHub Pages Active</div>
                    </div>
                </div>
                
                <div class="system-status">
                    <div class="system-status-header">
                        <div class="system-status-title">üéØ Current Task</div>
                    </div>
                    <div id="current-task" style="font-size: 16px; color: var(--text-secondary);">
                        Autonomous cycle complete - V6.2.8 deployed
                    </div>
                </div>
            </div>
            
            <!-- System Status View -->
            <div id="coordination" class="view">
                <h1 style="margin-bottom: 32px;">System Coordination</h1>
                
                <div class="system-status">
                    <div class="system-status-header">
                        <div class="system-status-title">‚ö° Process Status</div>
                    </div>
                    
                    <div class="coordination-grid">
                        <div class="process-card" id="forge-card">
                            <div class="process-header">
                                <div class="process-icon">üî®</div>
                                <div class="process-name">Forge Builder</div>
                                <div class="process-status idle" id="forge-status">IDLE</div>
                            </div>
                            <div class="process-meta" id="forge-meta">
                                Last activity: 2 minutes ago<br>
                                Status: Ready for next iteration
                            </div>
                        </div>
                        
                        <div class="process-card" id="tester-card">
                            <div class="process-header">
                                <div class="process-icon">üß™</div>
                                <div class="process-name">Autonomous Tester</div>
                                <div class="process-status idle" id="tester-status">IDLE</div>
                            </div>
                            <div class="process-meta" id="tester-meta">
                                Next scheduled: 4 hours<br>
                                Status: GPT-4 Vision enabled
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 24px; padding: 16px; background: var(--bg-tertiary); border-radius: 8px;">
                        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                            <span style="font-weight: 600;">üîê Coordination Lock</span>
                            <span id="lock-status" style="color: var(--text-secondary);">No active locks</span>
                        </div>
                        <div id="queue-status" style="font-size: 13px; color: var(--text-secondary);">
                            Queue: Empty
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Testing View -->
            <div id="testing" class="view">
                <h1 style="margin-bottom: 32px;">Autonomous Testing</h1>
                
                <div class="status-grid">
                    <div class="status-card">
                        <div class="status-card-header">
                            <div class="status-card-title">Last Test Run</div>
                            <div class="status-indicator idle"></div>
                        </div>
                        <div class="status-card-value" id="last-test-time">-</div>
                        <div class="status-card-label">Never run</div>
                    </div>
                    
                    <div class="status-card">
                        <div class="status-card-header">
                            <div class="status-card-title">Issues Found</div>
                            <div class="status-indicator idle"></div>
                        </div>
                        <div class="status-card-value" id="issues-count">0</div>
                        <div class="status-card-label">Total issues</div>
                    </div>
                    
                    <div class="status-card">
                        <div class="status-card-header">
                            <div class="status-card-title">GPT-4 Vision</div>
                            <div class="status-indicator active"></div>
                        </div>
                        <div class="status-card-value">‚úì</div>
                        <div class="status-card-label">Enabled</div>
                    </div>
                    
                    <div class="status-card">
                        <div class="status-card-header">
                            <div class="status-card-title">Next Run</div>
                            <div class="status-indicator active"></div>
                        </div>
                        <div class="status-card-value" id="next-test">4h</div>
                        <div class="status-card-label">Auto-scheduled</div>
                    </div>
                </div>
                
                <div class="system-status">
                    <div class="system-status-header">
                        <div class="system-status-title">üß™ Test Results</div>
                        <button class="btn" onclick="runManualTest()">‚ñ∂Ô∏è Run Test Now</button>
                    </div>
                    <div id="test-results" style="padding: 20px; text-align: center; color: var(--text-secondary);">
                        No test results yet. Click "Run Test Now" to start.
                    </div>
                </div>
            </div>
            
            <!-- Settings View -->
            <div id="settings" class="view">
                <h1 style="margin-bottom: 32px;">Settings</h1>
                
                <div class="settings-section">
                    <div class="settings-header">
                        <span>üß™</span>
                        Autonomous Testing
                    </div>
                    
                    <div class="setting-row">
                        <div class="setting-label">
                            <div class="setting-title">Enable Testing</div>
                            <div class="setting-description">Automatically test UI on schedule</div>
                        </div>
                        <div class="toggle-switch active" data-setting="autonomous_testing.enabled">
                            <div class="toggle-slider"></div>
                        </div>
                    </div>
                    
                    <div class="setting-row">
                        <div class="setting-label">
                            <div class="setting-title">Use GPT-4 Vision</div>
                            <div class="setting-description">Enable AI-powered visual analysis</div>
                        </div>
                        <div class="toggle-switch active" data-setting="autonomous_testing.use_gpt4">
                            <div class="toggle-slider"></div>
                        </div>
                    </div>
                    
                    <div class="setting-row">
                        <div class="setting-label">
                            <div class="setting-title">Test Schedule</div>
                            <div class="setting-description">How often to run tests (hours)</div>
                        </div>
                        <input type="number" class="input-field" value="6" min="1" max="24" data-setting="autonomous_testing.schedule_hours">
                    </div>
                    
                    <div class="setting-row">
                        <div class="setting-label">
                            <div class="setting-title">Pause During Iterations</div>
                            <div class="setting-description">Don't test while Forge is building</div>
                        </div>
                        <div class="toggle-switch active" data-setting="autonomous_testing.pause_during_iteration">
                            <div class="toggle-slider"></div>
                        </div>
                    </div>
                </div>
                
                <div class="settings-section">
                    <div class="settings-header">
                        <span>üî®</span>
                        Forge Builder
                    </div>
                    
                    <div class="setting-row">
                        <div class="setting-label">
                            <div class="setting-title">Email-Driven Builds</div>
                            <div class="setting-description">Process UI feedback from emails</div>
                        </div>
                        <div class="toggle-switch active" data-setting="forge_builder.email_driven">
                            <div class="toggle-slider"></div>
                        </div>
                    </div>
                    
                    <div class="setting-row">
                        <div class="setting-label">
                            <div class="setting-title">Auto-Deploy</div>
                            <div class="setting-description">Deploy to GitHub Pages automatically</div>
                        </div>
                        <div class="toggle-switch active" data-setting="forge_builder.auto_deploy">
                            <div class="toggle-slider"></div>
                        </div>
                    </div>
                    
                    <div class="setting-row">
                        <div class="setting-label">
                            <div class="setting-title">Wait for Tests</div>
                            <div class="setting-description">Wait for test results before deploying</div>
                        </div>
                        <div class="toggle-switch active" data-setting="forge_builder.wait_for_tests">
                            <div class="toggle-slider"></div>
                        </div>
                    </div>
                </div>
                
                <div class="settings-section">
                    <div class="settings-header">
                        <span>üîß</span>
                        Backend Configuration
                    </div>
                    
                    <div class="setting-row">
                        <div class="setting-label">
                            <div class="setting-title">OpenAI API Key <span class="status-indicator" id="openai-status">‚ùå</span></div>
                            <div class="setting-description">API key for GPT-4 Vision testing</div>
                        </div>
                        <input type="password" class="input-field" style="width: 250px;" id="openai-key" placeholder="Leave blank to keep current" data-setting="openai_api_key">
                    </div>
                    
                    <div class="setting-row">
                        <div class="setting-label">
                            <div class="setting-title">Gmail Address <span class="status-indicator" id="gmail-status">‚ùå</span></div>
                            <div class="setting-description">Email for receiving test reports</div>
                        </div>
                        <input type="email" class="input-field" style="width: 250px;" id="gmail-user" placeholder="Leave blank to keep current" data-setting="gmail_user">
                    </div>
                    
                    <div class="setting-row">
                        <div class="setting-label">
                            <div class="setting-title">GitHub Token <span class="status-indicator" id="github-token-status">‚ùå</span></div>
                            <div class="setting-description">Personal access token for deployments</div>
                        </div>
                        <input type="password" class="input-field" style="width: 250px;" id="github-token" placeholder="Leave blank to keep current" data-setting="github_token">
                    </div>
                    
                    <div class="setting-row">
                        <div class="setting-label">
                            <div class="setting-title">GitHub Repository <span class="status-indicator" id="github-repo-status">‚ùå</span></div>
                            <div class="setting-description">Format: username/repo-name</div>
                        </div>
                        <input type="text" class="input-field" style="width: 250px;" id="github-repo" placeholder="Leave blank to keep current" data-setting="github_repo">
                    </div>
                    
                    <div class="setting-row">
                        <div class="setting-label">
                            <div class="setting-title">Live Site URL <span class="status-indicator" id="live-url-status">‚ùå</span></div>
                            <div class="setting-description">GitHub Pages URL for testing</div>
                        </div>
                        <input type="url" class="input-field" style="width: 300px;" id="live-url" placeholder="Leave blank to keep current" data-setting="live_url">
                    </div>
                </div>
                
                <button class="btn" style="margin-top: 20px;" onclick="saveSettings()">üíæ Save Settings</button>
            </div>
            
            <!-- Activity Log View -->
            <div id="activity" class="view">
                <h1 style="margin-bottom: 32px;">Activity Log</h1>
                
                <div class="activity-log">
                    <div id="activity-log-content">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>
            </div>
            
            <!-- Preview View -->
            <div id="preview" class="view">
                <h1 style="margin-bottom: 32px;">Live Preview</h1>
                
                <div class="preview-container">
                    <div class="preview-header">
                        <div>
                            <strong>CODE_<span id="preview-version">V6.2.8</span></strong>
                            <span style="color: var(--text-secondary); margin-left: 12px;">‚ö° Just Updated</span>
                        </div>
                        <div style="display: flex; gap: 12px;">
                            <button class="btn btn-secondary" onclick="refreshPreview()">üîÑ Refresh</button>
                            <button class="btn" onclick="openInNewTab()">‚ÜóÔ∏è Open in New Tab</button>
                        </div>
                    </div>
                    <iframe id="preview-iframe" class="preview-iframe" src="frontlineops.html"></iframe>
                </div>
            </div>
        </main>
    </div>
    
    
    <script>
        let state = null;
        let pollInterval = null;
        
        // Initialize everything when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Initializing Forge Hub...');
            
            // Get DOM elements
            const menuToggle = document.getElementById('menuToggle');
            const sidebar = document.querySelector('aside');
            const overlay = document.getElementById('overlay');
            const navButtons = document.querySelectorAll('.nav-btn');
            const versionBadge = document.getElementById('versionBadge');
            
            console.log(`Found ${navButtons.length} navigation buttons`);
            
            // Update version badge with timestamp on click
            if (versionBadge) {
                versionBadge.style.cursor = 'pointer';
                let showingTimestamp = false;
                versionBadge.addEventListener('click', async function() {
                    if (!showingTimestamp) {
                        try {
                            const response = await fetch('state.json?_=' + Date.now());
                            const data = await response.json();
                            const lastUpdate = data.last_updated || data.deployment?.last_deployed;
                            if (lastUpdate) {
                                const date = new Date(lastUpdate);
                                versionBadge.textContent = date.toLocaleString('en-US', {
                                    month: 'short', day: 'numeric', 
                                    hour: '2-digit', minute: '2-digit'
                                });
                                showingTimestamp = true;
                                setTimeout(() => {
                                    versionBadge.textContent = 'V6.3.1';
                                    showingTimestamp = false;
                                }, 3000);
                            }
                        } catch(e) {
                            console.error('Failed to load timestamp:', e);
                        }
                    }
                });
            }
            
            // Navigation view switching
            navButtons.forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    const view = btn.dataset.view;
                    console.log('üéØ Switching to view:', view);
                    
                    // Update active nav button
                    navButtons.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    
                    // Update active view
                    document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
                    const targetView = document.getElementById(view);
                    if (targetView) {
                        targetView.classList.add('active');
                        console.log('‚úÖ View switched to:', view);
                    } else {
                        console.error('‚ùå View not found:', view);
                    }
                    
                    // Close mobile menu if open
                    if (window.innerWidth <= 768) {
                        sidebar.classList.add('collapsed');
                        overlay.classList.remove('active');
                    }
                });
            });
            
            // Mobile menu toggle
            function toggleMenu() {
                sidebar.classList.toggle('collapsed');
                overlay.classList.toggle('active');
                console.log('Menu toggled');
            }
            
            if (menuToggle) {
                menuToggle.addEventListener('click', toggleMenu);
            }
            if (overlay) {
                overlay.addEventListener('click', toggleMenu);
            }
            
            // Sidebar initialization
            function initializeSidebar() {
                if (window.innerWidth <= 768) {
                    sidebar.classList.add('collapsed');
                    overlay.classList.remove('active');
                } else {
                    sidebar.classList.remove('collapsed');
                    overlay.classList.remove('active');
                }
            }
            
            window.addEventListener('resize', initializeSidebar);
            initializeSidebar();
            
            // Start app
            loadState();
            loadBackendStatus();
            pollInterval = setInterval(loadState, 2000);
            
            console.log('‚úÖ Forge Hub initialized successfully');
        });
        
        // Load state
        async function loadState() {
            try {
                const response = await fetch('state.json?_=' + Date.now());
                state = await response.json();
                updateUI();
            } catch (error) {
                console.error('Failed to load state:', error);
            }
        }
        
        function updateUI() {
            if (!state) return;
            
            // Dashboard
            document.getElementById('current-iteration').textContent = state.iteration?.current || 0;
            document.getElementById('tests-passed').textContent = state.tests?.phase_a?.passing || 0;
            document.getElementById('code-version').textContent = 'V' + (state.version?.code || '6.2.8');
            document.getElementById('phase-status').textContent = (state.iteration?.phase || 'INIT') + ' Phase';
            document.getElementById('current-task').textContent = state.forge_status?.current_task || 'Ready';
            
            // Coordination
            updateCoordinationStatus();
            
            // Activity Log
            updateActivityLog();
            
            // Testing
            updateTestingStatus();
        }
        
        function updateCoordinationStatus() {
            const forgeCard = document.getElementById('forge-card');
            const testerCard = document.getElementById('tester-card');
            const forgeStatus = document.getElementById('forge-status');
            const testerStatus = document.getElementById('tester-status');
            
            const activeProcess = state.coordination?.active_process;
            
            // Reset
            forgeCard.classList.remove('active', 'locked');
            testerCard.classList.remove('active', 'locked');
            
            if (activeProcess === 'forge') {
                forgeCard.classList.add('active');
                testerCard.classList.add('locked');
                forgeStatus.textContent = 'RUNNING';
                forgeStatus.className = 'process-status running';
                testerStatus.textContent = 'WAITING';
                testerStatus.className = 'process-status waiting';
            } else if (activeProcess === 'tester') {
                testerCard.classList.add('active');
                forgeCard.classList.add('locked');
                testerStatus.textContent = 'RUNNING';
                testerStatus.className = 'process-status running';
                forgeStatus.textContent = 'WAITING';
                forgeStatus.className = 'process-status waiting';
            } else {
                forgeStatus.textContent = 'IDLE';
                forgeStatus.className = 'process-status idle';
                testerStatus.textContent = 'IDLE';
                testerStatus.className = 'process-status idle';
            }
            
            // Lock status
            const lockStatus = document.getElementById('lock-status');
            if (activeProcess) {
                lockStatus.textContent = `Locked by ${activeProcess}`;
                lockStatus.style.color = 'var(--accent-yellow)';
            } else {
                lockStatus.textContent = 'No active locks';
                lockStatus.style.color = 'var(--text-secondary)';
            }
            
            // Queue
            const queueStatus = document.getElementById('queue-status');
            const queueLength = state.coordination?.queue?.length || 0;
            if (queueLength > 0) {
                queueStatus.textContent = `Queue: ${queueLength} waiting`;
            } else {
                queueStatus.textContent = 'Queue: Empty';
            }
        }
        
        function updateActivityLog() {
            const container = document.getElementById('activity-log-content');
            const logs = state.build_log || [];
            
            container.innerHTML = logs.slice(-20).reverse().map(log => {
                const time = new Date(log.timestamp).toLocaleTimeString();
                let type = 'info';
                if (log.event.includes('‚úÖ')) type = 'success';
                if (log.event.includes('‚ö†Ô∏è')) type = 'warning';
                if (log.event.includes('‚ùå')) type = 'error';
                
                return `
                    <div class="log-entry">
                        <div class="log-time">${time}</div>
                        <div class="log-message">${log.event}</div>
                        <div class="log-type ${type}">${type.toUpperCase()}</div>
                    </div>
                `;
            }).join('');
        }
        
        function updateTestingStatus() {
            const testStatus = state.test_status;
            if (!testStatus) return;
            
            // Update last test time
            if (testStatus.last_run) {
                const lastRun = new Date(testStatus.last_run);
                const now = new Date();
                const diffMinutes = Math.floor((now - lastRun) / 60000);
                document.getElementById('last-test-time').textContent = diffMinutes + 'm';
            }
            
            // Update issues count
            document.getElementById('issues-count').textContent = testStatus.issues_found || 0;
            
            // Update next run
            if (testStatus.next_scheduled) {
                const nextRun = new Date(testStatus.next_scheduled);
                const now = new Date();
                const diffHours = Math.floor((nextRun - now) / 3600000);
                document.getElementById('next-test').textContent = diffHours + 'h';
            }
        }
        
        // Settings
        async function saveSettings() {
            // Collect all settings
            const settings = {
                autonomous_testing: {
                    enabled: document.querySelector('[data-setting="autonomous_testing.enabled"]').classList.contains('active'),
                    use_gpt4: document.querySelector('[data-setting="autonomous_testing.use_gpt4"]').classList.contains('active'),
                    schedule_hours: parseInt(document.querySelector('[data-setting="autonomous_testing.schedule_hours"]').value),
                    pause_during_iteration: document.querySelector('[data-setting="autonomous_testing.pause_during_iteration"]').classList.contains('active')
                },
                forge_builder: {
                    email_driven: document.querySelector('[data-setting="forge_builder.email_driven"]').classList.contains('active'),
                    auto_deploy: document.querySelector('[data-setting="forge_builder.auto_deploy"]').classList.contains('active'),
                    wait_for_tests: document.querySelector('[data-setting="forge_builder.wait_for_tests"]').classList.contains('active')
                },
                backend: {}
            };
            
            // Only include non-empty backend fields (don't overwrite with blanks)
            const openaiKey = document.getElementById('openai-key').value.trim();
            const gmailUser = document.getElementById('gmail-user').value.trim();
            const githubToken = document.getElementById('github-token').value.trim();
            const githubRepo = document.getElementById('github-repo').value.trim();
            const liveUrl = document.getElementById('live-url').value.trim();
            
            if (openaiKey) settings.backend.openai_api_key = openaiKey;
            if (gmailUser) settings.backend.gmail_user = gmailUser;
            if (githubToken) settings.backend.github_token = githubToken;
            if (githubRepo) settings.backend.github_repo = githubRepo;
            if (liveUrl) settings.backend.live_url = liveUrl;
            
            // Show what will be updated
            const updateMessage = Object.keys(settings.backend).length > 0 
                ? `Updating ${Object.keys(settings.backend).length} backend field(s)` 
                : 'No backend fields changed (blank fields keep existing values)';
            
            showModal('Settings saved! ' + updateMessage, JSON.stringify(settings, null, 2));
            
            // Clear input fields after save
            document.getElementById('openai-key').value = '';
            document.getElementById('gmail-user').value = '';
            document.getElementById('github-token').value = '';
            document.getElementById('github-repo').value = '';
            document.getElementById('live-url').value = '';
            
            // Update status indicators
            loadBackendStatus();
        }
        
        function showModal(title, content) {
            const modal = document.createElement('div');
            modal.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); z-index: 10000; display: flex; align-items: center; justify-content: center;';
            modal.innerHTML = `
                <div style="background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 12px; padding: 24px; max-width: 600px; max-height: 80vh; overflow-y: auto;">
                    <h2 style="margin-bottom: 16px;">${title}</h2>
                    <pre style="background: var(--bg-tertiary); padding: 16px; border-radius: 8px; overflow-x: auto; font-size: 12px; line-height: 1.5;">${content}</pre>
                    <button class="btn" style="margin-top: 16px; width: 100%;" onclick="this.closest('div').parentElement.remove()">Close</button>
                </div>
            `;
            document.body.appendChild(modal);
            modal.addEventListener('click', (e) => {
                if (e.target === modal) modal.remove();
            });
        }
        
        // Toggle switches
        document.querySelectorAll('.toggle-switch').forEach(toggle => {
            toggle.addEventListener('click', () => {
                toggle.classList.toggle('active');
            });
        });
        
        // Preview
        function refreshPreview() {
            const iframe = document.getElementById('preview-iframe');
            iframe.src = iframe.src.split('?')[0] + '?v=' + Date.now();
        }
        
        function openInNewTab() {
            window.open('https://jessetprudhomme.github.io/frontlineops-live', '_blank');
        }
        
        // Manual test
        function runManualTest() {
            alert('Manual test initiated! Check email for results.');
        }
        
        // Mobile menu toggle
        const menuToggle = document.getElementById('menuToggle');
        const sidebar = document.querySelector('aside');
        const overlay = document.getElementById('overlay');
        
        function toggleMenu() {
            sidebar.classList.toggle('collapsed');
            overlay.classList.toggle('active');
        }
        
        // Initialize sidebar state on load
        function initializeSidebar() {
            if (window.innerWidth <= 768) {
                // On mobile: start collapsed
                sidebar.classList.add('collapsed');
                overlay.classList.remove('active');
            } else {
                // On desktop: start open
                sidebar.classList.remove('collapsed');
                overlay.classList.remove('active');
            }
        }
        
        menuToggle.addEventListener('click', toggleMenu);
        overlay.addEventListener('click', toggleMenu);
        
        // Close menu when nav item clicked on mobile
        document.querySelectorAll('.nav-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                if (window.innerWidth <= 768) {
                    sidebar.classList.add('collapsed');
                    overlay.classList.remove('active');
                }
            });
        });
        
        // Handle window resize
        window.addEventListener('resize', initializeSidebar);
        
        // Initialize on load
        initializeSidebar();
        
        // Load backend configuration status
        async function loadBackendStatus() {
            try {
                // Check if settings exist in state
                const response = await fetch('state.json?_=' + Date.now());
                const state = await response.json();
                
                // For now, use hardcoded known values
                // In production, these would come from backend API
                const backendConfig = {
                    openai_api_key: ''OPENAI_KEY_CONFIGURED_BUT_HIDDEN'',
                    gmail_user: 'jesse.t.prudhomme@gmail.com',
                    github_token: 'ghp_...', // Placeholder
                    github_repo: 'jessetprudhomme/frontlineops-live',
                    live_url: 'https://jessetprudhomme.github.io/frontlineops-live'
                };
                
                // Update status indicators
                updateStatusIndicator('openai-status', backendConfig.openai_api_key);
                updateStatusIndicator('gmail-status', backendConfig.gmail_user);
                updateStatusIndicator('github-token-status', backendConfig.github_token);
                updateStatusIndicator('github-repo-status', backendConfig.github_repo);
                updateStatusIndicator('live-url-status', backendConfig.live_url);
                
                // Show masked values in placeholders
                if (backendConfig.openai_api_key) {
                    document.getElementById('openai-key').placeholder = 'Configured: ' + maskValue(backendConfig.openai_api_key);
                }
                if (backendConfig.gmail_user) {
                    document.getElementById('gmail-user').placeholder = 'Current: ' + backendConfig.gmail_user;
                }
                if (backendConfig.github_token) {
                    document.getElementById('github-token').placeholder = 'Configured: ' + maskValue(backendConfig.github_token);
                }
                if (backendConfig.github_repo) {
                    document.getElementById('github-repo').placeholder = 'Current: ' + backendConfig.github_repo;
                }
                if (backendConfig.live_url) {
                    document.getElementById('live-url').placeholder = 'Current: ' + backendConfig.live_url;
                }
            } catch (error) {
                console.error('Failed to load backend status:', error);
            }
        }
        
        function updateStatusIndicator(elementId, value) {
            const indicator = document.getElementById(elementId);
            if (!indicator) return;
            
            if (value && value !== '' && !value.includes('...')) {
                indicator.textContent = '‚úÖ'; // Green check
                indicator.style.color = 'var(--accent-green)';
            } else {
                indicator.textContent = '‚ùå'; // Red X
                indicator.style.color = 'var(--accent-red)';
            }
        }
        
        function maskValue(value) {
            if (!value || value.length < 10) return '***';
            return value.substring(0, 7) + '...' + value.substring(value.length - 4);
        }
    </script>
</body>
</html>
